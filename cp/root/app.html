<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ROOT Control Panel</title>

<style>
/* ========== BASE ========== */
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;
  background:#f8fafc;
  color:#0f172a;
}
.layout{
  display:flex;
  min-height:100vh;
}

/* ========== SIDEBAR ========== */
.sidebar{
  width:260px;
  background:#0f172a;
  color:white;
  padding:24px;
  display:flex;
  flex-direction:column;
  gap:18px;
}
.avatar{
  width:44px;height:44px;
  border-radius:50%;
  background:linear-gradient(135deg,#2563eb,#60a5fa);
  display:flex;align-items:center;justify-content:center;
  font-weight:700;
}
.nav-btn{
  background:none;border:none;
  color:#cbd5f5;
  padding:12px;
  border-radius:12px;
  text-align:left;
  cursor:pointer;
}
.nav-btn.active{background:#2563eb;color:white}

/* ========== CONTENT ========== */
.content{
  flex:1;
  padding:30px;
}

/* ===== DASHBOARD ===== */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:20px;
  margin-bottom:30px;
}
.card{
  background:white;
  padding:20px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
}
.card.big p{
  font-size:34px;
  font-weight:700;
}
.dept{
  display:flex;
  justify-content:space-between;
  font-weight:600;
}
.zsb{border-left:5px solid #2563eb}
.rs{border-left:5px solid #16a34a}
.jis{border-left:5px solid #f59e0b}
.njis{border-left:5px solid #ef4444}

/* ===== TOOLBAR ===== */
.toolbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.search-box{
  position:relative;
}
.search-box input{
  width:220px;
  padding:8px 32px 8px 12px;
  border-radius:10px;
  border:1px solid #e5e7eb;
}
.search-box span{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  opacity:.5;
}

/* ===== USERS TABLE ===== */
table{
  width:100%;
  border-collapse:separate;
  border-spacing:0 10px;
}
thead th{
  text-align:left;
  padding:12px 16px;
  font-size:13px;
  color:#64748b;
}
tbody tr{
  background:white;
  border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,.04);
}
tbody td{
  padding:16px;
}
.actions{
  display:flex;
  gap:6px;
  opacity:0;
}
tbody tr:hover .actions{opacity:1}
.icon-btn{
  width:32px;height:32px;
  border-radius:8px;
  border:none;
  background:#f1f5f9;
  cursor:pointer;
}
.icon-btn.danger{color:#ef4444}

/* ===== STATUS ===== */
.dot{
  width:8px;height:8px;
  border-radius:50%;
  display:inline-block;
}
.online{background:#22c55e}
.offline{background:#94a3b8}

/* ===== MOBILE ===== */
@media(max-width:768px){
  .layout{flex-direction:column}
  .sidebar{width:100%;flex-direction:row}
  .search-box input{width:100%}
}
</style>
</head>

<body class="layout">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div style="display:flex;gap:12px;align-items:center">
    <div class="avatar">R</div>
    <div>
      <strong>ROOT</strong><br>
      <span style="font-size:12px;color:#94a3b8">root@system.local</span>
    </div>
  </div>

  <button class="nav-btn active">Dashboard & Users</button>
</aside>

<!-- CONTENT -->
<main class="content">

  <!-- DASHBOARD -->
  <section class="cards">
    <div class="card big">
      <h4>Total Users</h4>
      <p id="totalUsers">0</p>
    </div>

    <div class="card dept zsb">ZSB <span id="zsbCount">0</span></div>
    <div class="card dept rs">R-S <span id="rsCount">0</span></div>
    <div class="card dept jis">JIS <span id="jisCount">0</span></div>
    <div class="card dept njis">N-JIS <span id="njisCount">0</span></div>
  </section>

  <!-- USERS -->
  <section>

    <div class="toolbar">
      <h3>Users</h3>
      <div class="search-box">
        <input id="search" placeholder="Search user‚Ä¶">
        <span>üîç</span>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th></th>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Dept</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="users"></tbody>
    </table>

  </section>

</main>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2"

const supabase = createClient(
  "https://YOUR_PROJECT.supabase.co",
  "PUBLIC_ANON_KEY"
)

/* ===== LOAD USERS ===== */
let timer = null

document.getElementById("search").addEventListener("input", e=>{
  clearTimeout(timer)
  timer = setTimeout(()=>{
    loadUsers(e.target.value)
  }, 400) // üëà DEBOUNCE
})

async function loadUsers(q=""){
  let query = supabase
    .from("users")
    .select("id,nom,email,role,department,is_active")

  if(q){
    query = query.or(
      `nom.ilike.%${q}%,email.ilike.%${q}%,role.ilike.%${q}%,department.ilike.%${q}%`
    )
  }

  const { data } = await query

  // stats
  totalUsers.textContent = data.length
  zsbCount.textContent = data.filter(u=>u.department==="ZSB").length
  rsCount.textContent  = data.filter(u=>u.department==="R-S").length
  jisCount.textContent = data.filter(u=>u.department==="JIS").length
  njisCount.textContent= data.filter(u=>u.department==="N-JIS").length

  const tbody = document.getElementById("users")
  tbody.innerHTML=""

  data.forEach(u=>{
    tbody.innerHTML+=`
      <tr>
        <td><span class="dot ${u.is_active?"online":"offline"}"></span></td>
        <td>${u.nom||"-"}</td>
        <td>${u.email}</td>
        <td>${u.role}</td>
        <td>${u.department||"-"}</td>
        <td>
          <div class="actions">
            <button class="icon-btn">‚úèÔ∏è</button>
            <button class="icon-btn danger">üóëÔ∏è</button>
          </div>
        </td>
      </tr>
    `
  })
}

loadUsers()
</script>

</body>
</html>
