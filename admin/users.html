<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin â€“ Users</title>
  <link rel="stylesheet" href="css/ui.css" />
</head>
<body>

<!-- ================= SIDEBAR ================= -->
<div class="sidebar">
  <h2 class="logo">ADMIN</h2>
  <a href="index.html">Dashboard</a>
  <a class="active">Users</a>
  <a href="history.html">Historic</a>
  <a href="#" id="logoutBtn" style="margin-top:30px;color:#ef4444">
    Logout
  </a>
</div>

<!-- ================= MAIN ================= -->
<div class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <h1>Users Management</h1>
    <button class="btn primary" onclick="openAdd()">
      + Add User
    </button>
  </div>

  <!-- USERS TABLE -->
  <div class="card">

    <!-- SEARCH -->
    <input
      type="text"
      placeholder="Search by name or email"
      oninput="searchUsers(this.value)"
      style="margin-bottom:12px;width:260px"
    />

    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Role</th>
          <th>Department</th>
          <th>Confirmed</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="users-table">
        <!-- filled by users.js -->
      </tbody>
    </table>
  </div>
</div>

<!-- ================= ADD USER MODAL ================= -->
<div class="modal" id="userModal">
  <div class="modal-card">
    <h3 id="modalTitle">Add User</h3>

    <input id="fullName" placeholder="Full name *" />
    <input id="email" placeholder="Email *" />

    <select id="role" onchange="handleRoleChange()">
      <option value="">Select role *</option>
      <option value="admin">Admin</option>
      <option value="directeur">Directeur</option>
      <option value="sous-directeur">Sous Directeur</option>
      <option value="supervisor">Supervisor</option>
      <option value="agent">Agent</option>
    </select>

    <!-- DEPARTMENT -->
    <select id="department" style="display:none">
      <option value="">Select department *</option>
      <option>ZSB</option>
      <option>JIS</option>
      <option>N-JIS</option>
      <option>R-S</option>
    </select>

    <div class="modal-actions">
      <button class="btn ghost" onclick="closeModal()">Cancel</button>
      <button class="btn primary" onclick="addUser()">Save</button>
    </div>
  </div>
</div>

<!-- ================= DELETE MODAL ================= -->
<div class="modal" id="deleteModal">
  <div class="modal-card">
    <h3>Delete user?</h3>
    <p class="muted">This action cannot be undone.</p>

    <div class="modal-actions">
      <button class="btn ghost" onclick="closeDelete()">Cancel</button>
      <button class="btn danger" onclick="confirmDelete()">Delete</button>
    </div>
  </div>
</div>

<!-- ================= SCRIPTS ================= -->
<script type="module" src="js/admin-auth.js"></script>
<script type="module" src="js/supabase-admin.js"></script>
<script type="module" src="js/users.js"></script>

<!-- ================= UI HELPERS ================= -->
<script>
  let deleteUserId = null;

  function openAdd() {
    document.getElementById("modalTitle").innerText = "Add User";
    document.getElementById("userModal").classList.add("show");
  }

  function closeModal() {
    document.getElementById("userModal").classList.remove("show");
  }

  function handleRoleChange() {
    const role = document.getElementById("role").value;
    const dep = document.getElementById("department");

    if (
      role === "directeur" ||
      role === "sous-directeur" ||
      role === "supervisor" ||
      role === "agent"
    ) {
      dep.style.display = "block";
    } else {
      dep.style.display = "none";
      dep.value = "";
    }
  }

  function askDelete(id) {
    deleteUserId = id;
    document.getElementById("deleteModal").classList.add("show");
  }

  function closeDelete() {
    document.getElementById("deleteModal").classList.remove("show");
  }

  function confirmDelete() {
    if (deleteUserId) {
      deleteUser(deleteUserId);
      closeDelete();
    }
  }
</script>

</body>
</html>
