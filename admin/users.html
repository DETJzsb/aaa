<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin – Users</title>
  <link rel="stylesheet" href="css/ui.css" />
</head>
<body>

<!-- ========== SIDEBAR ========== -->
<div class="sidebar">
  <h2 class="logo">ADMIN</h2>
  <a href="index.html">Dashboard</a>
  <a class="active">Users</a>
  <a href="history.html">Historic</a>
  <a href="#" id="logoutBtn" style="margin-top:30px;color:#ef4444">Logout</a>
</div>

<!-- ========== MAIN ========== -->
<div class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <h1>Users Management</h1>
    <!-- ✅ FIXED -->
    <button class="btn primary" onclick="openAdd()">+ Add User</button>
  </div>

  <!-- SEARCH -->
  <div class="card" style="margin-bottom:10px">
    <input id="searchInput" placeholder="Search by ID or Role" />
    <button class="btn ghost" onclick="loadUsers()">Refresh</button>
  </div>

  <!-- TABLE -->
  <div class="card">
    <table class="table">
      <thead>
        <tr>
          <th>User ID</th>
          <th>Role</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="users-table"></tbody>
    </table>
  </div>
</div>

<!-- ========== ADD USER MODAL ========== -->
<div class="modal" id="userModal">
  <div class="modal-card">
    <h3>Add User</h3>

    <input id="fullName" placeholder="Full name *" />
    <input id="email" placeholder="Email *" />

    <select id="role" onchange="handleRoleChange()">
      <option value="">Select role *</option>
      <option value="admin">Admin</option>
      <option value="directeur">Directeur</option>
      <option value="sous-directeur">Sous Directeur</option>
      <option value="supervisor">Supervisor</option>
      <option value="team-leader">Team Leader</option>
      <option value="agent">Agent</option>
    </select>

    <input id="matricule" placeholder="Matricule" />

    <select id="department" style="display:none">
      <option value="">Select department</option>
      <option>ZSB</option>
      <option>JIS</option>
      <option>N-JIS</option>
      <option>R-S</option>
    </select>

    <input id="parts" placeholder="Parts (Supervisor / TL)" />
    <input id="part" placeholder="Part (Agent)" />
    <input id="shift" placeholder="Shift" />
    <input id="line" placeholder="Line" />
    <input id="tel" placeholder="Tel" />
    <input id="whatsapp" placeholder="Whatsapp" />

    <div class="modal-actions">
      <button class="btn ghost" onclick="closeModal()">Cancel</button>
      <!-- ✅ Save = addUser -->
      <button class="btn primary" onclick="addUser()">Save</button>
    </div>
  </div>
</div>

<!-- ========== DETAILS MODAL ========== -->
<div class="modal" id="detailsModal">
  <div class="modal-card">
    <h3>User Details</h3>
    <pre id="detailsContent"></pre>
    <div class="modal-actions">
      <button class="btn ghost" onclick="closeDetails()">Close</button>
    </div>
  </div>
</div>

<!-- ========== DELETE MODAL ========== -->
<div class="modal" id="deleteModal">
  <div class="modal-card">
    <h3>Delete user?</h3>
    <p class="muted">This action cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn ghost" onclick="closeDelete()">Cancel</button>
      <button class="btn danger" onclick="confirmDelete()">Delete</button>
    </div>
  </div>
</div>

<!-- ========== SCRIPTS ========== -->
<script type="module" src="js/admin-auth.js"></script>
<script type="module" src="js/supabase-admin.js"></script>
<script type="module" src="js/users.js"></script>

<!-- ========== UI HELPERS ========== -->
<script>
  let deleteUserId = null;

  function openAdd() {
    document.getElementById("userModal").classList.add("show");
  }

  function closeModal() {
    document.getElementById("userModal").classList.remove("show");
  }

  function handleRoleChange() {
    const role = document.getElementById("role").value;
    const dep = document.getElementById("department");

    // admin / directeur ما عندهمش department
    if (role === "admin" || role === "directeur") {
      dep.style.display = "none";
      dep.value = "";
    } else {
      dep.style.display = "block";
    }
  }

  function askDelete(id) {
    deleteUserId = id;
    deleteModal.classList.add("show");
  }

  function closeDelete() {
    deleteModal.classList.remove("show");
  }

  function confirmDelete() {
    deleteUser(deleteUserId);
    closeDelete();
  }

  function closeDetails() {
    detailsModal.classList.remove("show");
  }
</script>

</body>
</html>
