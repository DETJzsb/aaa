<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Admin Login</title>
</head>
<body>

<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>

<script type="module">
import { supabase } from "./js/supabase-admin.js"
  
const { data: allProfiles, error: allErr } = await supabase
  .from("profiles")
  .select("*")

console.log("ALL PROFILES:", allProfiles, allErr)

allProfiles?.forEach(p => {
  console.log("PROFILE ID:", p.id, "== USER ID ?", p.id === user.id)
})

window.login = async function () {
  const email = document.getElementById("email").value
  const password = document.getElementById("password").value

  const { data: authData, error: authError } =
    await supabase.auth.signInWithPassword({ email, password })

  if (authError) {
    alert(authError.message)
    return
  }

  const user = authData.user
  console.log("AUTH USER ID:", user.id)

  const { data: profile, error: profileError } =
    await supabase
      .from("profiles")
      .select("role")
      .eq("id", user.id)
      .maybeSingle()

  console.log("PROFILE:", profile, profileError)

  if (!profile) {
    alert("Profile not found")
    return
  }

  if (profile.role !== "admin") {
    alert("Not admin")
    return
  }

  window.location.href = "/admin/index.html"
}
</script>

</body>
</html>
