<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Login</title>
</head>
<body>

<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>

<script type="module">
import { supabase } from "admin/js/supabase-admin.js";

window.login = async function () {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const { data: authData, error: authError } =
    await supabase.auth.signInWithPassword({ email, password });

  if (authError) {
    alert(authError.message);
    return;
  }

  const user = authData.user;

  const { data: profile, error } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", user.id)
    .maybeSingle();

  if (!profile) {
    alert("Profile not found");
    return;
  }

  if (profile.role !== "admin") {
    alert("Access denied");
    return;
  }

  window.location.href = "/aaa/admin/index.html";
};
</script>

</body>
</html>
